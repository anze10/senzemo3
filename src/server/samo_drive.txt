"use server"
import { auth } from "~/server/auth";
import { OAuth2Client } from "google-auth-library";
import { google } from "googleapis";

export async function createFolder() {
    const session = await auth();
    console.log({ access_token: session?.user.token });
    const client = new OAuth2Client({});


    client.setCredentials({
        access_token: session?.user.token,
    });

    const tokenInfo = await client.getTokenInfo(session?.user.token!);


    const service = google.drive({ version: 'v3', auth: client as any });
    const fileMetadata = {
        name: 'Invoices',
        mimeType: 'application/vnd.google-apps.folder',
    };
    try {
        const file = await service.files.create({
            requestBody: fileMetadata,
            fields: 'id',
        });
        console.log('Folder Id:', file.data.id);
        return file.data.id;
    } catch (err) {
        console.log(err);

        throw err;
    }